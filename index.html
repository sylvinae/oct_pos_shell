<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OCT POS - Pharmacy Management</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html,
      body,
      #app {
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
      #loading {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-family: system-ui, -apple-system, sans-serif;
        font-size: 18px;
        color: #666;
      }
      #app {
        display: none;
      }
      #app.loaded {
        display: block;
      }
    </style>
  </head>
  <body>
    <div id="loading">Loading OCT POS...</div>
    <iframe
      id="app"
      src="http://localhost:5173"
      style="width: 100%; height: 100%; border: none"
      allow="clipboard-read; clipboard-write"
    ></iframe>
    <!-- IMPORTANT: Before building for production, change the src above to your deployed frontend URL -->
    <!-- Example: src="https://your-frontend.netlify.app" -->
    <script type="module" src="/src/main.ts"></script>
    <script>
      const iframe = document.getElementById("app");
      const loading = document.getElementById("loading");
      const frontendUrl = iframe.src;
      let retryCount = 0;
      const maxRetries = 10;

      function checkFrontend() {
        fetch(frontendUrl)
          .then(() => {
            iframe.style.display = "block";
            iframe.onload = () => {
              loading.style.display = "none";
              iframe.classList.add("loaded");
            };
          })
          .catch(() => {
            retryCount++;
            if (retryCount < maxRetries) {
              loading.textContent = `Connecting to frontend... (${retryCount}/${maxRetries})`;
              setTimeout(checkFrontend, 2000);
            } else {
              loading.textContent = `Cannot connect to frontend at ${frontendUrl}. Please ensure the frontend server is running.`;
              loading.style.color = "#d32f2f";
            }
          });
      }

      checkFrontend();
    </script>
  </body>
</html>
